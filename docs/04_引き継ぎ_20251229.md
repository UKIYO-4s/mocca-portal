# Mocca Portal 引き継ぎドキュメント

**作成日:** 2025年12月29日 20:50 JST
**作成者:** Claude Code (Opus 4.5)

---

## 1. プロジェクト概要

飲食店（もっか・ばんしろう）向けの業務管理ポータルシステム。

| 項目 | 値 |
|------|-----|
| フレームワーク | Laravel 12 + React + TypeScript + Inertia.js |
| DB | MySQL 8.x / MariaDB |
| ステージング | https://mocca.sd-create.jp |
| リポジトリ | https://github.com/UKIYO-4s/mocca-portal |

---

## 2. 完了済みPhase

| Phase | 内容 | 完了日 |
|-------|------|--------|
| Phase 1 | コア基盤（認証・権限） | 2025/12/29 |
| Phase 2 | コア拡張 + 予約モジュール | 2025/12/29 |
| Phase C | JPYC投げ銭システム | 2025/12/29 |
| Phase 3 | チェックリストモジュール | 2025/12/29 |
| Phase 4 | 備品管理モジュール | 2025/12/29 |

---

## 3. 未着手Phase

| Phase | 内容 | 優先度 | 備考 |
|-------|------|--------|------|
| Phase 5 | タイムカードモジュール | 高 | 次に実装予定 |
| Phase 6 | お知らせモジュール | 中 | - |
| Phase 7 | シフトモジュール | 中 | - |
| Phase 8 | Googleカレンダー連携 | 低 | 後回し |
| Phase 9 | 二要素認証 | 低 | 後回し |

---

## 4. 本日の実装内容（Phase 4）

### 4.1 作成ファイル

```
app/Modules/Inventory/
├── Controllers/InventoryController.php  # 11メソッド
├── Models/
│   ├── InventoryItem.php                # 備品マスター
│   └── InventoryLog.php                 # 操作履歴
└── InventoryModule.php                  # ルート定義

database/migrations/
├── 2025_12_29_110226_create_inventory_items_table.php
└── 2025_12_29_110226_create_inventory_logs_table.php

resources/js/Pages/Inventory/
├── Index.tsx    # スタッフ用使用入力（在庫数非表示）
├── Manage.tsx   # 管理者用一覧
├── Create.tsx   # 新規登録
├── Edit.tsx     # 編集 + 補充/調整モーダル
└── Logs.tsx     # 操作履歴
```

### 4.2 コードレビュー対応履歴

| 指摘 | 対応 |
|------|------|
| ルート名不一致 (inventory.items.* → inventory.*) | 修正済み |
| destroy未実装 | 実装済み |
| 使用記録形式（単件→複数件対応） | 修正済み |
| logs paginate → get | 修正済み |
| notes/item_id フィールド名不一致 | 修正済み |
| 補充/調整ボタン405エラー | 修正済み（Edit画面へ遷移+モーダル自動表示） |
| logDeleted引数不足 | 修正済み |

---

## 5. Phase 5 タイムカードモジュール仕様

### 5.1 機能

| 機能 | Admin | Manager | Staff |
|------|:-----:|:-------:|:-----:|
| 自分の打刻（出勤/退勤） | ○ | ○ | ○ |
| 自分の履歴閲覧 | ○ | ○ | ○ |
| 他人の勤怠修正 | ○ | ○ | × |
| 月次レポート | ○ | ○ | × |

### 5.2 データベース（time_records）

| カラム | 型 | 説明 |
|--------|-----|------|
| id | bigint | PK |
| user_id | bigint | FK → users |
| date | date | 日付 |
| clock_in | timestamp | 出勤時刻 |
| clock_out | timestamp | 退勤時刻 |
| break_minutes | int | 休憩時間（分） |
| notes | text | 備考 |
| modified_by | bigint | FK → users（修正者） |
| modified_at | timestamp | 修正日時 |

### 5.3 画面

| 画面 | 対象 | 機能 |
|------|------|------|
| Index.tsx | 全員 | 打刻画面（出勤/退勤ボタン） |
| History.tsx | 全員 | 自分の勤務履歴 |
| Manage.tsx | Manager+ | 全スタッフ勤怠一覧・修正 |
| Reports.tsx | Manager+ | 月次レポート |

### 5.4 既存スケルトン

`app/Modules/TimeCard/TimeCardModule.php` が作成済み（ルートはコメントアウト状態）

### 5.5 実装前確認事項

1. **休憩時間の入力方法**: 手動入力 or 休憩開始/終了ボタン？
2. **打刻制限**: 1日1回のみ or 複数打刻可？
3. **レポート形式**: CSV出力は必要？

---

## 6. 開発環境

### 6.1 ローカル開発

```bash
# サーバー起動
php artisan serve
npm run dev

# ビルド
npm run build

# マイグレーション
php artisan migrate
```

### 6.2 デプロイ

```bash
# SSH接続
ssh root@100.103.127.122

# デプロイコマンド
cd /var/www/mocca-portal
git pull origin main
php artisan migrate --force
npm run build
php artisan config:cache
php artisan route:cache
```

### 6.3 テストアカウント

| メール | ロール |
|--------|--------|
| admin@mocca-portal.local | admin |
| manager@mocca-portal.local | manager |
| staff@mocca-portal.local | staff |

---

## 7. ディレクトリ構成

```
app/
├── Contracts/                    # インターフェース
├── Core/                         # コア機能
│   ├── BaseModule.php
│   └── ActivityLog/
├── Modules/                      # 機能モジュール
│   ├── Reservation/              # 予約（ばんしろう/もっか）
│   ├── Checklist/                # チェックリスト
│   ├── Inventory/                # 備品管理 ✅ 完了
│   ├── TimeCard/                 # タイムカード（スケルトン）
│   ├── Announcement/             # お知らせ（スケルトン）
│   └── Shift/                    # シフト（スケルトン）
└── Services/
    └── ActivityLogService.php

resources/js/
├── Components/                   # 共通コンポーネント
├── Layouts/
│   └── AuthenticatedLayout.tsx   # ナビゲーション
├── Pages/
│   ├── Reservations/             # 予約画面
│   ├── Checklists/               # チェックリスト画面
│   ├── Inventory/                # 備品管理画面 ✅ 完了
│   └── ...
└── types/
    └── index.d.ts                # TypeScript型定義
```

---

## 8. 参照ドキュメント

| ファイル | 内容 |
|----------|------|
| docs/01_システム仕様書.md | 全体仕様・DB設計 |
| docs/02_実装計画書.md | 実装手順・コード例 |
| docs/03_進捗管理.md | 進捗・実行ログ |

---

## 9. 注意事項

1. **モジュールパターン**
   - 各モジュールは `BaseModule` を継承
   - `boot()` でルート登録、コメントアウト解除で有効化

2. **コードレビュー観点**
   - Inertiaパスと実ファイルの一致
   - ルート名の一致
   - Props名の一致（Controller ↔ React）
   - paginate() vs get()（フロントが配列前提の場合）
   - フィールド名の一致（DB ↔ Model ↔ TypeScript）

3. **デプロイ時**
   - `php artisan migrate --force` を忘れずに
   - `npm run build` でフロントエンドビルド
   - キャッシュクリア/再生成

---

## 10. 次のアクション

1. Phase 5 の確認事項（休憩入力方法、打刻制限、CSV出力）を確認
2. Phase 5 タイムカードモジュール実装
3. Phase 6 以降は優先度に応じて実装

---

**引き継ぎ完了**
